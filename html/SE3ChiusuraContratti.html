<!-- Modal HTML -->
<div id="SE3ChiusuraContratti" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="service-gw">
				<div class="span12">
					<form id="upload-chiusura-contratti" role="form" action="/ime/mt/chiusura_contratti?separatore=|&formatoData=dd/mm/yyyy&separatoreDecimali=,." enctype="multipart/form-data" method="post">
						<h2>Caricamento SE3 Chiusura Contratti</h2>
						<hr>
						<div class="form-group">
							<input type="file" name="example">
						</div>
							
						<div class="form-group">
							<input type="submit" class="btn btn-primary" value="Submit">
							<input type="reset" class="btn btn-default" value="Reset" onclick="resetSE3ChiusuraContrattiMessage()">
						</div>
						
						<div id="SE3ChiusuraContrattiMessage">
						</div>
						
							
						<script>
							$.support.cors = true;
							var textType = /^.*\.csv$/;
							var reader = new FileReader();
							$('#upload-chiusura-contratti input[type="submit"]').addClass('disabled');
							$('#upload-chiusura-contratti input[type="file"]').change(function(e) {
								resetSE3ChiusuraContrattiMessage();
								var file = $('#upload-chiusura-contratti input[type="file"]')[0].files[0];
								if (file.name.match(textType)) {
									reader.readAsText(file);
									reader.onloadstart = function(){
										$('#upload-chiusura-contratti input[type="submit"]').addClass('disabled');
									}
									reader.onloadend = function(){
										$('#upload-chiusura-contratti input[type="submit"]').removeClass('disabled');
									};
								} else {
									$('#SE3ChiusuraContrattiMessage').replaceWith('<div id="SE3ChiusuraContrattiMessage" class="alert alert-info"><strong>Errore! </strong> File non supportato</div>');
									$('#upload-chiusura-contratti input[type="submit"]').addClass('disabled');
								}
							});

							$("#upload-chiusura-contratti").submit(function(e) {
								e.preventDefault();
								e.stopImmediatePropagation();
								if(!$('#upload-chiusura-contratti input[type="submit"]').hasClass('disabled')){
									$.ajax({
										type: "POST",
										cache: false,
										url: $(this).attr('action'),
										data: reader.result,
										dataType: 'json',
										success: function(data) {
											if (data.info.status == true) {
											   $('#SE3ChiusuraContrattiMessage').replaceWith('<div id="SE3ChiusuraContrattiMessage" class="alert alert-success"><strong>Successo! </strong>' + data.info.description + '</div>');
											   $('#upload-chiusura-contratti')[0].reset();
											   $('#upload-chiusura-contratti input[type="submit"]').addClass('disabled');
											} else {
												$('#SE3ChiusuraContrattiMessage').replaceWith('<div id="SE3ChiusuraContrattiMessage" class="alert alert-danger"><strong>Errore! </strong>' + data.info.description + '</div>');
											}
										},
										error: function(data, textStatus, errorThrown){
											$('#SE3ChiusuraContrattiMessage').replaceWith('<div id="SE3ChiusuraContrattiMessage" class="alert alert-danger"><strong>Errore! </strong>' + errorThrown + '</div>');
										}
									});
								}
							});
															
							function resetSE3ChiusuraContrattiMessage() {
								$('#SE3ChiusuraContrattiMessage').replaceWith('<div id="SE3ChiusuraContrattiMessage"></div>');
								$('#upload-chiusura-contratti input[type="submit"]').addClass('disabled');
							}
						</script>
						
					</form>
					
				</div>
				<div class="modal-footer">
					<img class="navbar-brand" src="https://www.gruppoiren.it/iren_gruppo-theme/images/logo_iren_color.png"></img>
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
		$('#upload-chiusura-contratti input[type="file"]').filestyle({
			buttonName: 'btn-warning'
		});
	</script>
</div>